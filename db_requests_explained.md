# Объяснение SQL-запросов в проекте

В этом документе объясняются SQL-запросы и связанные с ними методы, используемые в `db-service`.

## 1. Получение списка задач (GET)

**Обработчик:** `getHandler`

**Запрос:**
```go
err := db.Select(&todos, "SELECT * FROM todo_items")
```

**Объяснение:**
*   `SELECT * FROM todo_items`: Этот запрос извлекает все (`*`) записи из таблицы `todo_items`.
*   `db.Select()`: Это метод из библиотеки `sqlx`, который выполняет запрос и сохраняет результат в срезе `todos`. Он автоматически сопоставляет столбцы из базы данных с полями структуры `model.TodoItem`.

## 2. Создание новой задачи (POST)

**Обработчик:** `createHandler`

**Запрос:**
```go
tx := db.MustBegin()
tx.MustExec("INSERT INTO todo_items (id, title, done) VALUES ($1, $2, $3)", uuid.New().String(), item.Title, false)
tx.Commit()
```

**Объяснение:**
*   `INSERT INTO todo_items (id, title, done) VALUES ($1, $2, $3)`: Этот запрос вставляет новую запись в таблицу `todo_items`.
    *   `(id, title, done)`: Указывает столбцы, в которые будут вставлены данные.
    *   `VALUES ($1, $2, $3)`: Заполнители для передаваемых значений. Это помогает предотвратить SQL-инъекции.
*   `db.MustBegin()`: Начинает новую транзакцию. Транзакция — это последовательность операций, которые выполняются как единое целое.
*   `tx.MustExec()`: Выполняет запрос внутри транзакции. `MustExec` вызовет панику, если произойдет ошибка.
*   `tx.Commit()`: Сохраняет все изменения, сделанные в рамках транзакции. Если бы произошла ошибка, мы бы использовали `tx.Rollback()`, чтобы отменить все изменения.

## 3. Удаление задачи (DELETE)

**Обработчик:** `deleteHandler`

**Запрос:**
```go
tx := db.MustBegin()
result, err := tx.Exec("DELETE FROM todo_items WHERE id = $1", item.Id)
if err != nil {
    tx.Rollback()
    // ... обработка ошибки
}
tx.Commit()
```

**Объяснение:**
*   `DELETE FROM todo_items WHERE id = $1`: Этот запрос удаляет запись из таблицы `todo_items`, у которой `id` совпадает с переданным значением.
*   `tx.Exec()`: Выполняет запрос, который не возвращает строк (например, `INSERT`, `UPDATE`, `DELETE`). Он возвращает объект `sql.Result` и ошибку.
*   `tx.Rollback()`: Отменяет транзакцию в случае ошибки. Это гарантирует, что частичные изменения не будут сохранены в базе данных.
*   `result.RowsAffected()`: Этот метод возвращает количество строк, затронутых выполненным запросом. Это полезно для проверки, была ли запись действительно удалена.

## 4. Обновление задачи (PUT)

**Обработчик:** `putHandler`

**Запрос:**
```go
tx := db.MustBegin()
result, err := tx.Exec("UPDATE todo_items SET done = true WHERE id = $1", item.Id)
// ...
tx.Commit()
```

**Объяснение:**
*   `UPDATE todo_items SET done = true WHERE id = $1`: Этот запрос обновляет запись в таблице `todo_items`.
    *   `SET done = true`: Устанавливает значение столбца `done` в `true`.
    *   `WHERE id = $1`: Указывает, какую именно запись нужно обновить.

## Ключевые методы

*   **Транзакции (`Begin`, `Commit`, `Rollback`)**: Транзакции используются для обеспечения целостности данных. Они позволяют сгруппировать несколько операций в одну атомарную единицу. Либо все операции в транзакции успешно выполняются (`Commit`), либо все они отменяются (`Rollback`), если что-то пошло не так.
*   **`Exec()`**: Используется для SQL-команд, которые не возвращают строки (например, `INSERT`, `UPDATE`, `DELETE`). Возвращает `sql.Result`, который содержит информацию о результате операции (например, количество затронутых строк), и ошибку.
*   **`RowsAffected()`**: Метод объекта `sql.Result`. Возвращает количество строк, измененных запросом. Полезен для проверки того, что операция (например, удаление или обновление) действительно затронула ожидаемое количество записей.
